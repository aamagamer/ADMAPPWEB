<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/airbnb.css"
    />
    <title>Solicitud de Permiso</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Arial", sans-serif;
      }
      body {
        background-color: #f5f5f5;
        color: #333;
      }
      header {
        background-color: #2c3e50;
        color: white;
        padding: 40px 0;
        height: 180px;
        display: flex;
        align-items: center;
        position: relative;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      .header-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        width: 100%;
      }
      .header-center {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .logo {
        width: 25%;
        margin-bottom: 15px;
      }
      h1 {
        font-size: 28px;
        font-weight: 600;
        text-align: center;
      }
      .menu-button {
        background-color: transparent;
        color: white;
        border: 2px solid white;
        border-radius: 4px;
        padding: 8px 15px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        margin-bottom: 100px;
      }
      .menu-button:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }
      .main-container {
        max-width: 1200px;
        margin: 50px auto;
        padding: 0 20px;
      }
      .welcome-section {
        text-align: center;
        margin-bottom: 30px;
      }
      .welcome-message {
        font-size: 24px;
        color: #2c3e50;
        margin-bottom: 20px;
      }
      .form-container {
        background-color: white;
        padding: 40px;
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        max-width: 600px;
        margin: 0 auto;
      }
      .form-title {
        text-align: center;
        margin-bottom: 30px;
        color: #2c3e50;
        font-size: 22px;
      }
      .form-group {
        margin-bottom: 25px;
      }
      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #555;
      }
      input[type="date"],
      input[type="time"],
      textarea {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
      }
      .time-fields {
        display: flex;
        gap: 20px;
      }
      .time-fields .form-group {
        flex: 1;
      }

      select {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
        background-color: white;
        appearance: none; /* Oculta el estilo por defecto en la mayoría de navegadores */
        background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" width="14" height="10"><polygon points="0,0 14,0 7,10" style="fill:%23666"/></svg>');
        background-repeat: no-repeat;
        background-position: right 12px center;
        background-size: 12px 10px;
        cursor: pointer;
        transition: border-color 0.3s, box-shadow 0.3s;
      }

      select:focus {
        border-color: #2c3e50;
        outline: none;
        box-shadow: 0 0 5px rgba(44, 62, 80, 0.3);
      }

      .submit-button {
        width: 100%;
        padding: 12px;
        background-color: #2c3e50;
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
      }
      .submit-button:hover {
        background-color: #1a252f;
      }
      #confirm-modal button:hover {
        opacity: 0.92;
      }
      @keyframes fadeIn {
        from {
          transform: scale(0.95);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="header-container">
        <a href="empleado.html"
          ><button class="menu-button">Menú Principal</button></a
        >
        <div class="header-center">
          <img src="Media/logo.png" alt="Logo" class="logo" />
          <h1>Solicitud de Permiso</h1>
        </div>
        <div style="width: 120px"></div>
      </div>
    </header>

    <div class="main-container">
      <div class="welcome-section">
        <div class="welcome-message">
          Hola <span id="employee-name">Empleado</span>!
        </div>
        <p>Por favor completa el siguiente formulario</p>
      </div>

      <div class="form-container">
        <h2 class="form-title">Detalles del permiso</h2>
        <form id="permiso-form" action="#" method="post">
          <div class="form-group">
            <label for="fecha">Día Solicitado</label>
            <input type="date" id="fecha" name="fecha" required />
          </div>
          <div class="time-fields">
            <div class="form-group">
              <label for="hora-inicio">Hora de inicio del Permiso</label>
              <input type="time" id="hora-inicio" name="hora-inicio" required />
            </div>
            <div class="form-group">
              <label for="hora-fin">Hora de fin del Permiso</label>
              <input type="time" id="hora-fin" name="hora-fin" required />
            </div>
          </div>

          <div class="form-group">
            <label for="tipo-compensacion">Tipo de Compensación</label>
            <select id="tipo-compensacion" name="tipo-compensacion" required>
              <option value="">Selecciona una opción</option>
            </select>
          </div>

          <div class="form-group">
            <label for="actividades">Descripción</label>
            <textarea
              id="actividades"
              name="actividades"
              placeholder="Describe en detalle el motivo de tu permiso..."
              required
            ></textarea>
          </div>
          <button type="submit" class="submit-button">Enviar Solicitud</button>
        </form>
      </div>
    </div>

    <!-- Modal Confirmación -->
    <div
      id="confirm-modal"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: rgba(0, 0, 0, 0.6);
        justify-content: center;
        align-items: center;
        z-index: 1000;
        font-family: Arial, sans-serif;
      "
    >
      <div
        style="
          background-color: #fff;
          padding: 30px 25px;
          border-radius: 12px;
          max-width: 400px;
          width: 90%;
          height: 400px;
          display: flex;
          flex-direction: column;
          justify-content: space-between;
          text-align: center;
          box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
          animation: fadeIn 0.3s ease-in-out;
        "
      >
        <div>
          <h2 style="margin-bottom: 10px; color: #333">Confirmar Solicitud</h2>
          <p id="modal-text" style="font-size: 16px; color: #555"></p>
        </div>
        <div style="margin-bottom: 10px">
          <button
            id="confirm-btn"
            style="
              background-color: #4caf50;
              color: white;
              border: none;
              padding: 14px 24px;
              margin-bottom: 10px;
              border-radius: 8px;
              font-size: 17px;
              width: 100%;
              cursor: pointer;
            "
          >
            Confirmar
          </button>
          <button
            id="cancel-btn"
            style="
              background-color: #f44336;
              color: white;
              border: none;
              padding: 14px 24px;
              border-radius: 8px;
              font-size: 17px;
              width: 100%;
              cursor: pointer;
            "
          >
            Cancelar
          </button>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const fechaInput = document.getElementById("fecha");
        const formulario = document.querySelector("form");
        const horaInicio = document.getElementById("hora-inicio");
        const horaFin = document.getElementById("hora-fin");
        const actividades = document.getElementById("actividades");
        const modal = document.getElementById("confirm-modal");
        const modalText = document.getElementById("modal-text");
        const confirmBtn = document.getElementById("confirm-btn");
        const cancelBtn = document.getElementById("cancel-btn");

        // Establecer fecha mínima visual (para el input)
        const ahora = new Date();
        const fechaMin = new Date(ahora.getTime() + 28 * 60 * 60 * 1000);
        fechaMin.setHours(0, 0, 0, 0);

        const formatDate = (date) => {
          const y = date.getFullYear();
          const m = String(date.getMonth() + 1).padStart(2, "0");
          const d = String(date.getDate()).padStart(2, "0");
          return `${y}-${m}-${d}`;
        };

        fechaInput.min = formatDate(fechaMin);

        // Formato bonito para el modal
        const formatHumanDate = (fechaStr) => {
          const fecha = new Date(fechaStr);
          return fecha.toLocaleDateString("es-MX", {
            weekday: "long",
            day: "numeric",
            month: "long",
            year: "numeric",
          });
        };

        formulario.addEventListener("submit", (e) => {
          e.preventDefault();

          // Validar campos vacíos
          if (
            !fechaInput.value ||
            !horaInicio.value ||
            !horaFin.value ||
            !actividades.value.trim()
          ) {
            alert("Por favor completa todos los campos.");
            return;
          }

          // Validar que la hora de fin sea posterior a la de inicio
          const horaInicioObj = new Date(`2000-01-01T${horaInicio.value}`);
          const horaFinObj = new Date(`2000-01-01T${horaFin.value}`);

          if (horaFinObj <= horaInicioObj) {
            alert("La hora de fin debe ser mayor a la hora de inicio.");
            return;
          }

          // Validación de 28 horas (fecha + hora)
          const fechaHoraPermiso = new Date(
            `${fechaInput.value}T${horaInicio.value}`
          );
          const ahora = new Date();
          const diferencia = fechaHoraPermiso.getTime() - ahora.getTime();

          if (diferencia < 28 * 60 * 60 * 1000) {
            alert(
              "Debes solicitar el permiso con al menos 28 horas de anticipación."
            );
            return;
          }

          // Mostrar modal con los datos del permiso
          const fechaFormateada = formatHumanDate(fechaInput.value);
          const descripcion = actividades.value.trim();

          modalText.innerHTML = `
            Solicitas un permiso para el día <strong>${fechaFormateada}</strong><br>
            De <strong>${horaInicio.value}</strong> a <strong>${horaFin.value}</strong><br><br>
            <em>Motivo:</em> ${descripcion}<br><br>
            ¿Deseas confirmar la solicitud?
        `;
          modal.style.display = "flex";
        });

        confirmBtn.addEventListener("click", () => {
          modal.style.display = "none";
          alert("Permiso registrado correctamente.");
          window.location.href = "empleado.html";
        });

        cancelBtn.addEventListener("click", () => {
          modal.style.display = "none";
        });
      });

      fetch("/api/compensaciones")
        .then((response) => response.json())
        .then((data) => {
          const select = document.getElementById("tipo-compensacion");
          if (data.compensaciones) {
            data.compensaciones.forEach((tipo) => {
              const option = document.createElement("option");
              option.value = tipo;
              option.textContent = tipo;
              select.appendChild(option);
            });
          }
        })
        .catch((error) => {
          console.error("Error al cargar las compensaciones:", error);
        });
    </script>
  </body>
</html>
