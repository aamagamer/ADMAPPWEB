<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ADM - Historial Inteligente</title>
    <link rel="stylesheet" href="css/liderHistorial.css" />
    <link rel="icon" href="Media/favicon.ico" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <button class="back-button" onclick="window.history.back()">
            <i class="fas fa-arrow-left"></i> Regresar
        </button>
        <div class="header-container">
            <img src="Media/logo.png" alt="Logo" class="logo" />
            <h1>Historial Inteligente</h1>
        </div>
    </header>

    <div class="main-container">
        <!-- Tabs/Pestañas -->
        <div class="tabs">
            <button class="tab-button active" onclick="openTab('reportes')">Reportes</button>
            <button class="tab-button" onclick="openTab('vacaciones')">Vacaciones</button>
            <button class="tab-button" onclick="openTab('permisos')">Permisos</button>
            <button class="tab-button" onclick="openTab('actas')">Actas Administrativas</button>
            <button class="tab-button" onclick="openTab('incapacidades')">Incapacidades</button>
        </div>

        <!-- Contenido de las pestañas -->
        <div id="reportes" class="tab-content active">
            <h2>Reportes Registrados</h2>
            <div class="filtro-fechas">
                <label for="fecha-inicio-reportes">Desde:</label>
                <input type="date" id="fecha-inicio-reportes" class="filtro-fecha">
                
                <label for="fecha-fin-reportes">Hasta:</label>
                <input type="date" id="fecha-fin-reportes" class="filtro-fecha">
                
                <button onclick="filtrarPorFechas('reportes')" class="btn-filtrar">Filtrar</button>
                <button onclick="limpiarFiltroFechas('reportes')" class="btn-limpiar">Limpiar</button>
            </div>
            <div class="table-container">
                <table id="reportes-table" class="display nowrap" style="width:100%">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Usuario</th>
                            <th>Observaciones</th>
                            <th>Tipo Asunto</th>
                            <th>Fecha Reporte</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div id="vacaciones" class="tab-content">
            <h2>Solicitudes de Vacaciones</h2>
            <div class="filtro-fechas">
                <label for="fecha-inicio-vacaciones">Desde:</label>
                <input type="date" id="fecha-inicio-vacaciones" class="filtro-fecha">
                
                <label for="fecha-fin-vacaciones">Hasta:</label>
                <input type="date" id="fecha-fin-vacaciones" class="filtro-fecha">
                
                <button onclick="filtrarPorFechas('vacaciones')" class="btn-filtrar">Filtrar</button>
                <button onclick="limpiarFiltroFechas('vacaciones')" class="btn-limpiar">Limpiar</button>
            </div>
            <div class="table-container">
                <table id="vacaciones-table" class="display nowrap" style="width:100%">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Usuario</th>
                            <th>Estado</th>
                            <th>Días Solicitados</th>
                            <th>Fecha Salida</th>
                            <th>Fecha Regreso</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div id="permisos" class="tab-content">
            <h2>Solicitudes de Permisos</h2>
            <div class="filtro-fechas">
                <label for="fecha-inicio-permisos">Desde:</label>
                <input type="date" id="fecha-inicio-permisos" class="filtro-fecha">
                
                <label for="fecha-fin-permisos">Hasta:</label>
                <input type="date" id="fecha-fin-permisos" class="filtro-fecha">
                
                <button onclick="filtrarPorFechas('permisos')" class="btn-filtrar">Filtrar</button>
                <button onclick="limpiarFiltroFechas('permisos')" class="btn-limpiar">Limpiar</button>
            </div>
            <div class="table-container">
                <table id="permisos-table" class="display nowrap" style="width:100%">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Usuario</th>
                            <th>Estado</th>
                            <th>Día Solicitado</th>
                            <th>Horario</th>
                            <th>Razón</th>
                            <th>Tipo Compensación</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- NUEVA PESTAÑA: ACTAS ADMINISTRATIVAS -->
        <div id="actas" class="tab-content">
            <h2>Actas Administrativas</h2>
            <div class="filtro-fechas">
                <label for="fecha-inicio-actas">Desde:</label>
                <input type="date" id="fecha-inicio-actas" class="filtro-fecha">
                
                <label for="fecha-fin-actas">Hasta:</label>
                <input type="date" id="fecha-fin-actas" class="filtro-fecha">
                
                <button onclick="filtrarPorFechas('actas')" class="btn-filtrar">Filtrar</button>
                <button onclick="limpiarFiltroFechas('actas')" class="btn-limpiar">Limpiar</button>
            </div>
            <div class="table-container">
                <table id="actas-table" class="display nowrap" style="width:100%">
                    <thead>
                        <tr>
                            <th>Usuario</th>
                            <th>Tipo Asunto</th>
                            <th>Fecha Acta</th>
                            <th>Comentario</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- NUEVA PESTAÑA: INCAPACIDADES -->
        <div id="incapacidades" class="tab-content">
            <h2>Historial de Incapacidades</h2>
            <div class="filtro-fechas">
                <label for="fecha-inicio-incapacidades">Desde:</label>
                <input type="date" id="fecha-inicio-incapacidades" class="filtro-fecha">
                
                <label for="fecha-fin-incapacidades">Hasta:</label>
                <input type="date" id="fecha-fin-incapacidades" class="filtro-fecha">
                
                <button onclick="filtrarPorFechas('incapacidades')" class="btn-filtrar">Filtrar</button>
                <button onclick="limpiarFiltroFechas('incapacidades')" class="btn-limpiar">Limpiar</button>
            </div>
            <div class="table-container">
                <table id="incapacidades-table" class="display nowrap" style="width:100%">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Usuario</th>
                            <th>Tipo de Incapacidad</th>
                            <th>Fecha Inicio</th>
                            <th>Fecha Final</th>
                            <th>Días</th>
                            <th>Observaciones</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script>
document.addEventListener('DOMContentLoaded', function() {
    // Obtener el idUsuario desde localStorage
    window.currentUserId = getCurrentUserId();
    
    if (!window.currentUserId) {
        mostrarError('No se encontró información de usuario. Por favor, inicia sesión nuevamente.');
        return;
    }
    
    // Inicializar las tablas
    initReportesTable();
    initVacacionesTable();
    initPermisosTable();
    initActasTable();
    initIncapacidadesTable();
    
    // Cargar datos iniciales
    loadReportes();
});

// Función para obtener el ID del usuario desde localStorage
function getCurrentUserId() {
    return localStorage.getItem('idUsuario');
}

// Función para mostrar errores al usuario
function mostrarError(mensaje) {
    console.error(mensaje);
    alert(mensaje); // Puedes reemplazar por tu sistema de notificaciones
}

// Función mejorada para parsear fechas correctamente
function parsearFecha(fechaString) {
    if (!fechaString) return null;
    
    // Si es formato dd/mm/yyyy (como lo renderiza DataTables)
    if (fechaString.includes('/')) {
        const [dia, mes, año] = fechaString.split('/');
        return new Date(año, mes - 1, dia);
    }
    
    // Si es formato yyyy-mm-dd (como lo del input)
    if (fechaString.includes('-')) {
        return new Date(fechaString + 'T00:00:00');
    }
    
    // Si es un objeto Date
    if (fechaString instanceof Date) {
        return fechaString;
    }
    
    // Intentar parsearlo directamente
    const fecha = new Date(fechaString);
    return isNaN(fecha.getTime()) ? null : fecha;
}

// Función mejorada para comparar solo fechas (sin hora)
function compararFechas(fecha1, fecha2) {
    if (!fecha1 || !fecha2) return false;
    
    const f1 = new Date(fecha1.getFullYear(), fecha1.getMonth(), fecha1.getDate());
    const f2 = new Date(fecha2.getFullYear(), fecha2.getMonth(), fecha2.getDate());
    
    return f1.getTime() === f2.getTime();
}

function openTab(tabId) {
    // Ocultar todos los contenidos de pestañas
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // Desactivar todos los botones de pestañas
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
    });
    
    // Mostrar el contenido de la pestaña seleccionada
    document.getElementById(tabId).classList.add('active');
    
    // Activar el botón de la pestaña seleccionada
    event.currentTarget.classList.add('active');
    
    // Cargar datos si es necesario
    if (tabId === 'reportes' && !window.reportesLoaded) {
        loadReportes();
    } else if (tabId === 'vacaciones' && !window.vacacionesLoaded) {
        loadVacaciones();
    } else if (tabId === 'permisos' && !window.permisosLoaded) {
        loadPermisos();
    } else if (tabId === 'actas' && !window.actasLoaded) {
        loadActas();
    } else if (tabId === 'incapacidades' && !window.incapacidadesLoaded) {
        loadIncapacidades();
    }
}

// Función mejorada para filtrar por fechas
function filtrarPorFechas(tabla) {
    let fechaInicio, fechaFin, table;
    
    switch(tabla) {
        case 'reportes':
            fechaInicio = document.getElementById('fecha-inicio-reportes').value;
            fechaFin = document.getElementById('fecha-fin-reportes').value;
            table = window.reportesTable;
            break;
        case 'vacaciones':
            fechaInicio = document.getElementById('fecha-inicio-vacaciones').value;
            fechaFin = document.getElementById('fecha-fin-vacaciones').value;
            table = window.vacacionesTable;
            break;
        case 'permisos':
            fechaInicio = document.getElementById('fecha-inicio-permisos').value;
            fechaFin = document.getElementById('fecha-fin-permisos').value;
            table = window.permisosTable;
            break;
        case 'actas':
            fechaInicio = document.getElementById('fecha-inicio-actas').value;
            fechaFin = document.getElementById('fecha-fin-actas').value;
            table = window.actasTable;
            break;
        case 'incapacidades':
            fechaInicio = document.getElementById('fecha-inicio-incapacidades').value;
            fechaFin = document.getElementById('fecha-fin-incapacidades').value;
            table = window.incapacidadesTable;
            break;
    }
    
    if (!fechaInicio && !fechaFin) {
        alert('Por favor, selecciona al menos una fecha');
        return;
    }
    
    // Redibujar la tabla para aplicar filtros
    table.draw();
}

// Función para limpiar el filtro de fechas
function limpiarFiltroFechas(tabla) {
    switch(tabla) {
        case 'reportes':
            document.getElementById('fecha-inicio-reportes').value = '';
            document.getElementById('fecha-fin-reportes').value = '';
            window.reportesTable.draw();
            break;
        case 'vacaciones':
            document.getElementById('fecha-inicio-vacaciones').value = '';
            document.getElementById('fecha-fin-vacaciones').value = '';
            window.vacacionesTable.draw();
            break;
        case 'permisos':
            document.getElementById('fecha-inicio-permisos').value = '';
            document.getElementById('fecha-fin-permisos').value = '';
            window.permisosTable.draw();
            break;
        case 'actas':
            document.getElementById('fecha-inicio-actas').value = '';
            document.getElementById('fecha-fin-actas').value = '';
            window.actasTable.draw();
            break;
        case 'incapacidades':
            document.getElementById('fecha-inicio-incapacidades').value = '';
            document.getElementById('fecha-fin-incapacidades').value = '';
            window.incapacidadesTable.draw();
            break;
    }
}

function initReportesTable() {
    window.reportesTable = $('#reportes-table').DataTable({
        dom: 'Bfrtip',
        buttons: [
            'copy', 'csv', 'excel', 'pdf'
        ],
        responsive: true,
        language: {
            url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
        },
        columns: [
            { data: 'idReporte' },
            { 
                data: null,
                render: function(data) {
                    return `${data.Nombres} ${data.Paterno} ${data.Materno}`;
                }
            },
            { data: 'Observaciones' },
            { data: 'TipoAsunto' },
            { 
                data: 'FechaReporte',
                render: function(data) {
                    return new Date(data).toLocaleDateString('es-ES');
                },
                type: 'date'
            }
        ]
    });
}

function initVacacionesTable() {
    window.vacacionesTable = $('#vacaciones-table').DataTable({
        dom: 'Bfrtip',
        buttons: [
            'copy', 'csv', 'excel', 'pdf'
        ],
        responsive: true,
        language: {
            url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
        },
        columns: [
            { data: 'idVacaciones' },
            { 
                data: null,
                render: function(data) {
                    return `${data.Nombres} ${data.Paterno} ${data.Materno}`;
                }
            },
            { data: 'EstadoSolicitud' },
            { data: 'DiasSolicitados' },
            { 
                data: 'FechaSalida',
                render: function(data) {
                    return new Date(data).toLocaleDateString('es-ES');
                },
                type: 'date'
            },
            { 
                data: 'FechaRegreso',
                render: function(data) {
                    return new Date(data).toLocaleDateString('es-ES');
                },
                type: 'date'
            }
        ]
    });
}

function initPermisosTable() {
    window.permisosTable = $('#permisos-table').DataTable({
        dom: 'Bfrtip',
        buttons: [
            'copy', 'csv', 'excel', 'pdf'
        ],
        responsive: true,
        language: {
            url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
        },
        columns: [
            { data: 'idPermiso' },
            { 
                data: null,
                render: function(data) {
                    return `${data.Nombres} ${data.Paterno} ${data.Materno}`;
                }
            },
            { data: 'EstadoSolicitud' },
            { 
                data: 'DiaSolicitado',
                render: function(data) {
                    return new Date(data).toLocaleDateString('es-ES');
                },
                type: 'date'
            },
            { 
                data: null,
                render: function(data) {
                    return `${data.HoraInicio} - ${data.HoraFin}`;
                }
            },
            { data: 'Razon' },
            { data: 'TipoCompensacion' }
        ]
    });
}

function initActasTable() {
    window.actasTable = $('#actas-table').DataTable({
        dom: 'Bfrtip',
        buttons: [
            'copy', 'csv', 'excel', 'pdf'
        ],
        responsive: true,
        language: {
            url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
        },
        columns: [
            { 
                data: null,
                render: function(data) {
                    return `${data.nombres} ${data.paterno} ${data.materno}`;
                }
            },
            { data: 'TipoAsunto' },
            { 
                data: 'FechaActa',
                render: function(data) {
                    return new Date(data).toLocaleDateString('es-ES');
                },
                type: 'date'
            },
            { 
                data: 'Comentario',
                render: function(data) {
                    // Limitar la longitud del comentario para mejor visualización
                    if (data && data.length > 50) {
                        return data.substring(0, 50) + '...';
                    }
                    return data || '';
                }
            }
        ]
    });
}

function initIncapacidadesTable() {
    window.incapacidadesTable = $('#incapacidades-table').DataTable({
        dom: 'Bfrtip',
        buttons: [
            'copy', 'csv', 'excel', 'pdf'
        ],
        responsive: true,
        language: {
            url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
        },
        columns: [
            { data: 'idIncapacidad' },
            { 
                data: null,
                render: function(data) {
                    return `${data.nombres} ${data.paterno} ${data.materno}`;
                }
            },
            { data: 'tipo' },
            { 
                data: 'fechaInicio',
                render: function(data) {
                    return data ? new Date(data).toLocaleDateString('es-ES') : '';
                },
                type: 'date'
            },
            { 
                data: 'fechaFinal',
                render: function(data) {
                    return data ? new Date(data).toLocaleDateString('es-ES') : '';
                },
                type: 'date'
            },
            {
                data: null,
                render: function(data) {
                    if (data.fechaInicio && data.fechaFinal) {
                        const inicio = new Date(data.fechaInicio);
                        const final = new Date(data.fechaFinal);
                        const diferencia = Math.ceil((final - inicio) / (1000 * 60 * 60 * 24)) + 1;
                        return diferencia + ' días';
                    }
                    return '';
                }
            },
            { 
                data: 'observaciones',
                render: function(data) {
                    if (data && data.length > 50) {
                        return data.substring(0, 50) + '...';
                    }
                    return data || '';
                }
            }
        ]
    });
}

// FILTRO GLOBAL ÚNICO - Se ejecuta después de inicializar todas las tablas
$(document).ready(function() {
    // Limpiar filtros existentes para evitar duplicados
    $.fn.dataTable.ext.search.length = 0;
    
    // Agregar un solo filtro global que maneje todas las tablas
    $.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {
        const tableId = settings.nTable.id;
        
        // Determinar qué inputs de fecha usar según la tabla
        let fechaInicio, fechaFin, columnaFecha;
        
        if (tableId === 'reportes-table') {
            fechaInicio = document.getElementById('fecha-inicio-reportes').value;
            fechaFin = document.getElementById('fecha-fin-reportes').value;
            columnaFecha = 4; // Columna de FechaReporte
        } else if (tableId === 'vacaciones-table') {
            fechaInicio = document.getElementById('fecha-inicio-vacaciones').value;
            fechaFin = document.getElementById('fecha-fin-vacaciones').value;
            columnaFecha = 4; // Columna de FechaSalida
        } else if (tableId === 'permisos-table') {
            fechaInicio = document.getElementById('fecha-inicio-permisos').value;
            fechaFin = document.getElementById('fecha-fin-permisos').value;
            columnaFecha = 3; // Columna de DiaSolicitado
        } else if (tableId === 'actas-table') {
            fechaInicio = document.getElementById('fecha-inicio-actas').value;
            fechaFin = document.getElementById('fecha-fin-actas').value;
            columnaFecha = 2; // Columna de FechaActa
        } else if (tableId === 'incapacidades-table') {
            fechaInicio = document.getElementById('fecha-inicio-incapacidades').value;
            fechaFin = document.getElementById('fecha-fin-incapacidades').value;
            columnaFecha = 3; // Columna de Fecha Inicio
        } else {
            return true; // Si no es una tabla conocida, mostrar todo
        }
        
        // Si no hay fechas de filtro, mostrar todo
        if (!fechaInicio && !fechaFin) {
            return true;
        }
        
        // Obtener la fecha de la fila actual
        const fechaFila = parsearFecha(data[columnaFecha]);
        if (!fechaFila) return false;
        
        // Parsear fechas de filtro
        const inicio = fechaInicio ? parsearFecha(fechaInicio) : null;
        const fin = fechaFin ? parsearFecha(fechaFin) : null;
        
        // Aplicar filtro
        if (inicio && fin) {
            return fechaFila >= inicio && fechaFila <= fin;
        } else if (inicio) {
            return fechaFila >= inicio;
        } else if (fin) {
            return fechaFila <= fin;
        }
        
        return true;
    });
});

// Funciones de carga de datos con autenticación
function loadReportes() {
    const userId = window.currentUserId;
    if (!userId) {
        mostrarError('No se pudo obtener el ID del usuario. Por favor, inicia sesión nuevamente.');
        return;
    }

    fetch(`/api/reportes-historial?idUsuario=${userId}`)
        .then(response => {
            if (!response.ok) {
                throw new Error(`Error HTTP: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (data.error) {
                mostrarError(data.error);
                return;
            }
            window.reportesTable.clear().rows.add(data).draw();
            window.reportesLoaded = true;
        })
        .catch(error => {
            console.error('Error al cargar reportes:', error);
            mostrarError('Error al cargar los reportes: ' + error.message);
        });
}

function loadVacaciones() {
    const userId = window.currentUserId;
    if (!userId) {
        mostrarError('No se pudo obtener el ID del usuario. Por favor, inicia sesión nuevamente.');
        return;
    }

    fetch(`/api/vacaciones-historial?idUsuario=${userId}`)
        .then(response => {
            if (!response.ok) {
                throw new Error(`Error HTTP: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (data.error) {
                mostrarError(data.error);
                return;
            }
            window.vacacionesTable.clear().rows.add(data).draw();
            window.vacacionesLoaded = true;
        })
        .catch(error => {
            console.error('Error al cargar vacaciones:', error);
            mostrarError('Error al cargar las vacaciones: ' + error.message);
        });
}

function loadPermisos() {
    const userId = window.currentUserId;
    if (!userId) {
        mostrarError('No se pudo obtener el ID del usuario. Por favor, inicia sesión nuevamente.');
        return;
    }

    fetch(`/api/permisos-historial?idUsuario=${userId}`)
        .then(response => {
            if (!response.ok) {
                throw new Error(`Error HTTP: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (data.error) {
                mostrarError(data.error);
                return;
            }
            window.permisosTable.clear().rows.add(data).draw();
            window.permisosLoaded = true;
        })
        .catch(error => {
            console.error('Error al cargar permisos:', error);
            mostrarError('Error al cargar los permisos: ' + error.message);
        });
}

function loadActas() {
    const userId = window.currentUserId;
    if (!userId) {
        mostrarError('No se pudo obtener el ID del usuario. Por favor, inicia sesión nuevamente.');
        return;
    }

    fetch(`/api/actas?idUsuario=${userId}`)
        .then(response => {
            if (!response.ok) {
                throw new Error(`Error HTTP: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (data.error) {
                mostrarError(data.error);
                return;
            }
            window.actasTable.clear().rows.add(data).draw();
            window.actasLoaded = true;
        })
        .catch(error => {
            console.error('Error al cargar actas:', error);
            mostrarError('Error al cargar las actas: ' + error.message);
        });
}

function loadIncapacidades() {
    const userId = window.currentUserId;
    if (!userId) {
        mostrarError('No se pudo obtener el ID del usuario. Por favor, inicia sesión nuevamente.');
        return;
    }

    fetch(`/api/incapacidades-historial?idUsuario=${userId}`)
        .then(response => {
            if (!response.ok) {
                throw new Error(`Error HTTP: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (data.error) {
                mostrarError(data.error);
                return;
            }
            window.incapacidadesTable.clear().rows.add(data).draw();
            window.incapacidadesLoaded = true;
        })
        .catch(error => {
            console.error('Error al cargar incapacidades:', error);
            mostrarError('Error al cargar las incapacidades: ' + error.message);
        });
}
    </script>
</body>
</html>
